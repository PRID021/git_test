Some modified from master branch
